#!/bin/bash -e

# Setup common env vars and folders
source /var/vcap/packages/bosh-helpers/ctl_setup.sh 'route_registrar'
PIDFILE=${RUN_DIR}/route_registrar.pid
CONFIG_FILE=/var/vcap/jobs/route_registrar/config/registrar_settings.json

case $1 in

start)
  pid_guard ${PIDFILE} ${JOB_NAME}

  exec 1>> $LOG_DIR/$OUTPUT_LABEL.log
  exec 2>> $LOG_DIR/$OUTPUT_LABEL.err.log

  exec chpst -u vcap:vcap  /var/vcap/packages/route_registrar/bin/route-registrar \
  -pidfile=${PIDFILE} \
  -configPath=${CONFIG_FILE}
;;

stop)
  kill_and_wait ${PIDFILE}
;;

*)
echo "Usage: route_registrar_ctl {start|stop}" ;;

esac
