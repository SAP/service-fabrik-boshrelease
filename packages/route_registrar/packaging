set -e

export GOPATH=$BOSH_INSTALL_TARGET
export GOROOT=$(readlink -nf /var/vcap/packages/golang)
export PATH=$GOROOT/bin:$PATH

mkdir -p "${GOPATH}/bin"
mkdir -p "${GOPATH}/src"

cp -a ${BOSH_COMPILE_TARGET}/{code.cloudfoundry.org,github.com} ${GOPATH}/src/

pushd ${GOPATH}/src/code.cloudfoundry.org/route-registrar
  go build -o "${BOSH_INSTALL_TARGET}/bin/route-registrar" .
popd

chmod +x "${BOSH_INSTALL_TARGET}/bin/route-registrar"

rm -rf "${GOPATH}/pkg" "${GOPATH}/src"
